# Continuous Delivery Pipeline for Kubernetes

This **Continuous Delivery Pipeline**  example shows you how to deploy and manage microservices based application on Kubernetes using the Argo workflow engine. An Argo Workflow is a Kubernetes custom resource that consists of steps and every step runs as a container within a Kubernetes pod. 

The microservices based app used in this example is open source [Sock Shop](https://github.com/microservices-demo/microservices-demo). 


## Prerequisites
This tutorial assumes the following:

* You have set your Kubernetes context to the correct cluster
* You have successfully [installed Argo on Kubernetes](https://applatix.com/open-source/argo/get-started/installation)
* You have installed Argo CLI



## About the YAML Files

The CD workflow uses the Kubernetes manifests and Argo workflow YAMLs from [Argo github](https://github.com/argoproj/example-cd)

Main workflows are

* [Sock shop workflow](https://github.com/argoproj/example-cd/blob/master/workflows/sock-shop-workflow.yaml) to deploy all sock shop microservices as stateful containers using persistent volumes. 
* [Logging workflow](https://github.com/argoproj/example-cd/blob/master/workflows/logging-workflow.yaml) to setup log management using ELK and Kibana
* [Monitoring workflow](https://github.com/argoproj/example-cd/blob/master/workflows/monitoring-workflow.yaml) to setup monitoring using Prometheus and Graphana

In this example we have used steps calling Kubectl to deploy. You can also use steps calling Helm charts to deploy

### Cluster Role Setup 

For logging and monitoring you will need to create cluster roles in kubernetes:

```
$ kubectl create clusterrolebinding cluster-admin-binding --clusterrole=cluster-admin --user="user login id"
$ kubectl create -f example-cd/logging-cr
$ kubectl create -f example-cd/monitoring-cr
```

### Deployment:

```
$ cd workflows
$ argo submit logging-workflow.yaml
$ argo submit sock-shop-workflow.yaml
$ argo submit monitoring-workflow.yaml
```

### Cleanup:
```
$ argo submit monitoring-cleanup-workflow.yaml
$ argo submit sock-shop-cleanup-workflow.yaml
$ argo submit logging-cleanup-workflow.yaml

```

### Get Status of each job 
Get the status of the running job:


```
$ argo get <job_name>

```

### Get the logs of any step in the workflow

```
$ argo logs <step_name/podname>

```


### From Browser
You can see the workflow status in the Argo Web UI. You can also check the logs and artifacts generated by each step.

 


